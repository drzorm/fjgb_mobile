var shotHost="mobilechat.im";var _mc_host="http://m.mobilechat.im";var chost="http://chat.mobilechat.im";var visit_host="http://visit.mobilechat.im";var stat_host="http://stat.mobilechat.im";var remote_ip_info,_G={},wrapDiv,iplookup_url="http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js";var cb1,cb2,st=window.localStorage;var bjspath="/js/unit/button.js";var ft="";var Browser_Agent=navigator.userAgent;if(Browser_Agent.indexOf("MSIE")!=-1){var a=navigator.browserLanguage;if(a=="zh-CN"){ft=""}else if(a=="zh-TW"){ft="_ft"}else if(a=="zh-HK"){ft="_ft"}}else{var b=navigator.language;if(b=="zh-CN"){ft=""}else if(b=="zh-TW"){ft="_ft"}else if(b=="zh-HK"){ft="_ft"}}if(!JSON){getScript(_mc_host+"/js/lib/json2.js")}_G["ios4"]=false;var ua=Browser_Agent.toLowerCase();if(ua.indexOf("iphone os 4_")>=0){_G["ios4"]=true}if(ua.indexOf("msie 8.0")>=0){_G["ie8"]=true}function mRS(length){var str_arr=[];var digit=0;for(var i=0;i<length;i++){digit=Math.floor(Math.random()*10);str_arr.push(digit.toString())}return str_arr.join("")}function cookieCode(){return"006600"+(new Date).getTime().toString()+""+mRS(5)}function setCookie(c_name,value,expires){var exdate=new Date;exdate.setTime(exdate.getTime()+(expires||90*24*3600*1e3));var val=c_name+"="+escape(value)+"; path=/; expires="+exdate.toGMTString();document.cookie=val}function getCookie(c_name){if(document.cookie.length>0){var c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;var c_end=document.cookie.indexOf(";",c_start);if(c_end==-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end))}}return""}var getElementsByClassName=function(searchClass,node,tag){node=node||document;tag=tag||"*";var returnElements=[];var els=tag==="*"&&node.all?node.all:node.getElementsByTagName(tag);var i=els.length;searchClass=searchClass.replace(/\-/g,"\\-");var pattern=new RegExp("(^|\\s)"+searchClass+"(\\s|$)");while(--i>=0){if(pattern.test(els[i].className)){returnElements.push(els[i])}}return returnElements};var makeQuery=function(json){var json=json||{};var query_arr=[];for(var key in json){var val=json[key];query_arr.push(key+"="+encodeURIComponent(val))}var query=query_arr.join("&").replace(/%20/g,"+");return query};var makeUrl=function(url,query){if(url.indexOf("?")<=0){return url+"?"+query}else{return url+"&"+query}};var jsonp=function(src,json,cb_name){var query=makeQuery(json)+"&callback="+cb_name;var script=document.createElement("script");script["src"]=src+"?"+query;document.body.appendChild(script)};var getScript=function(src,json){var query=makeQuery(json);var script=document.createElement("script");if(query.length>0){script["src"]=src+"?"+query}else{script["src"]=src}document.body.appendChild(script)};var empty=function(){};var ajax=function(options){var url=options.url;var method=options.method||"GET";var params=options.params||{};params.__=(new Date).getTime();var success=options.success||function(){};var error=options.error||function(){};var timeout=options.timeout||18e4;var timeoutCb=options.timeoutCb;var timer=null;if(!url)return null;if(method=="GET")url=makeUrl(url,makeQuery(params));var xhr=new XMLHttpRequest;xhr.open(method,url,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;clearTimeout(timer);var rstext=xhr.responseText;if(xhr.status>=200&&xhr.status<300||xhr.status==304){success(rstext,xhr)}else{error(rstext,xhr)}}else{}};if(method=="GET"){xhr.send(null)}else if(method=="POST"){var query=makeQuery(params);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");xhr.send(query)}timer=setTimeout(function(){if(xhr){xhr.onreadystatechange=empty;xhr.abort();timeoutCb()}},timeout)};var createMobileChatButton=function(data){var buttonObj=data["ubutton"];var tel=data["utel"];var classes=[];var strcss="";var style=buttonObj["style"];var margins=buttonObj["margins"].split(",");var color=buttonObj["color"];var image=buttonObj["image"];var size=buttonObj["size"];_G.style=style;if(style=="2"){_G.btn2b=margins[1]}var BUTTON_CSS={0:"position:fixed; top:100px; right:0px",1:"position:fixed; bottom:0px; right:0px; height:60px",2:"position:fixed; right:"+margins[0]+"px; bottom:"+margins[1]+"px",3:" max-width:320px; max-height:40px;margin:0 auto ",4:"position:fixed; top:130px; right:0px",5:""};var IOS4_BUTTON_CSS={0:"position:absolute; top:100px; right:0px",1:"position:absolute; bottom:0px; right:0px; height:60px",2:"position:absolute; right:"+margins[0]+"px; bottom:"+margins[1]+"px",3:" max-width:320px; max-height:40px;margin:0 auto ",4:"position:absolute; top:130px; right:0px",5:""};var BUTTON_HTML={0:'<a id="_mc_jump" href="" target="_blank"><img border="0" src="http://www.mobilechat.im'+image+'" /></a>',1:'<a id="_mc_jump" href=""><img border="0" src="http://www.mobilechat.im/image/button/fan'+color+'.png" style="width: 60px"/></a>',2:'<a id="_mc_jump" href=""><img border="0" style="width:'+size+"px;height:"+size+'px;" src="http://www.mobilechat.im/image/button/round'+color+ft+'.png" /></a>',3:'<img border="0" src="'+_mc_host+"/image/button/lump"+ft+'.png" style="width:100%;"/><div style="clear:both"></div><a href="tel:'+tel+'" style="display:block;position:absolute;top:0;left:0;width:50%;height:100%;"></a><span id="_mc_jump" style="display:block;position:absolute;top:0;right:0;width:50%;height:100%"></span>',4:'<a id="_mc_jump" href="" target="_blank"><img border="0" src="http://www.mobilechat.im/image/button/right'+color+ft+'.png" border="0" style="width: 35px;height:115px;"/></a>',5:"<div></div>"};var css;if(_G["ios4"]){css=IOS4_BUTTON_CSS[style]}else{css=BUTTON_CSS[style]}var html=BUTTON_HTML[style];var div=document.createElement("div");div.className="mc_button";div.innerHTML=html;div["style"]["cssText"]=css;div["style"]["zIndex"]=999;if(style=="3"){wrapDiv=document.createElement("div");wrapDiv.innerHTML=div.outerHTML;var bodyWidth=document.body.clientWidth;window.onresize=function(){wrapDiv.style.width=document.body.clientWidth+"px"};if(_G["ios4"]){wrapDiv.style.cssText="position:absolute; top:"+(window.innerHeight-40).toString()+"px;height:40px;width:"+bodyWidth+"px;background-image:url("+_mc_host+"/image/button/lump"+color+ft+"bg.png);"}else{wrapDiv.style.cssText="z-index:999;position:fixed; bottom:0;height:40px;width:"+bodyWidth+"px;background-image:url("+_mc_host+"/image/button/lump"+color+ft+"bg.png);"}_G.button=wrapDiv;document.body.appendChild(wrapDiv)}else{document.body.appendChild(div);_G.button=div}var mc_jump=document.getElementById("_mc_jump");if(mc_jump){if(mc_jump.onclick){delete mc_jump.onclick}mc_jump.onclick=function(e){toChat();return e.preventDefault()}}document.onscroll=function(){if(_G["ios4"]){switch(_G.style){case"0":_G.button.style["top"]=100+window.pageYOffset+"px";break;case"1":_G.button.style["top"]=(window.pageYOffset+window.innerHeight-60).toString()+"px";break;case"2":var height=_G.button.style["height"];_G.button.style["top"]=(window.pageYOffset+window.innerHeight-height-_G.btn2b).toString()+"px";break;case"3":_G.button.style["top"]=(window.pageYOffset+window.innerHeight-40).toString()+"px";break;case"4":_G.button.style["top"]=100+window.pageYOffset+"px";break;default:break}}};return div};var createInviteChatButton=function(inviteContent){var css="width:100%;bottom:0px;max-width:320px;height:40px;margin:0 auto;position:relative;";var html="<span id='countdown' style='color:rgb(141, 141, 141);margin:5px;margin-left:50px;line-height:32px;font-size:18px;display:inline-block;float:left'>5</span><span style='color: #468847;line-height:41px;font-size:16px;width:200px;overflow:hidden;display:inline-block;'>"+inviteContent+"</span><img id='mcrefuse' src='http://www.mobilechat.im/image/centerclose.png' style='position:absolute;right:0;height:20px;padding:10px;display:inline-block' />";var div=document.createElement("div");div.className="mc_invite_chat";div.innerHTML=html;div["style"]["cssText"]=css;div["style"]["zIndex"]=21474836;var wrapInviteDiv=document.createElement("div");wrapInviteDiv.innerHTML=div.outerHTML;var bodyWidth=document.body.clientWidth;wrapInviteDiv.style.cssText="position:fixed; bottom:0;height:40px;width:"+bodyWidth+"px;background:#dff0d8;border: 1px solid #d6e9c6;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;";document.body.appendChild(wrapInviteDiv);var preOnResize=window.onresize;window.onresize=function(){preOnResize();var bodyWidth=document.body.clientWidth;wrapInviteDiv["style"]["width"]=bodyWidth+"px"};var countdownObj=document.getElementById("countdown");var second=5;var interval=setInterval(function(){second--;countdownObj.innerHTML=second;if(second==0){clearInterval(interval)}},1e3);var chatTimeout=setTimeout(function(){toChat(_G["inviteUs"]);document.body.removeChild(wrapInviteDiv)},5500);document.getElementById("mcrefuse").onclick=function(){clearTimeout(chatTimeout);visitPoll(true);delete _G.inviteUs;document.body.removeChild(wrapInviteDiv)}};var createSelfDefButton=function(){var css="position:fixed; width:100%; height:120px; top:32%; color:#000; z-index:9999999";var html='<div class="mcinvitor mcselfdefinvitor" style="width:240px;height:100%;margin:auto;position:relative;"><div class="mcsure" style="width:80px;height:50px;position:absolute;"></div><div class="mccancel" style="width:50px;height:30px;position:absolute;"></div></div>';var div=document.createElement("div");div.innerHTML=html;div.style.cssText=css;document.body.appendChild(div);return div};var createInvitorCenterButton=function(){var css="position:fixed; width:100%; height:115px; top:32%; color:#000; z-index:9999999";var html='<div class="mcinvitor" style="width:240px;height:100%;margin:auto;background:#fff;border-radius:10px;-webkit-box-shadow:rgba(0, 0, 0, 0.498039) 0px 0px 20px;-moz-box-shadow:rgba(0, 0, 0, 0.498039) 0px 0px 20px;box-shadow:rgba(0, 0, 0, 0.498039) 0px 0px 20px;"><div style="height:30%;position:relative"><img border="0" class="mccancel" border="0" src="http://www.mobilechat.im/image/centerclose.png" style="position:absolute;right:0;height:20px;padding:10px" /></div><div class="invitorBtnContent" style="font-size:16px;margin:5px 5px 18px 5px;text-align:center"></div><div style="position:absolute;bottom:13px"><button type="button" class="mcsure" style="color:#fff;background-color:#25b2a2;border:transparent;text-shadow:0 -1px 0 rgba(0, 0, 0, 0.25);border-radius:4px;padding:4px 20px;text-align:center;height:30px;line-height:24px;font-size:16px;margin:0 0 0 84px" ></button></div></div>';var div=document.createElement("div");div.innerHTML=html;div.style.cssText=css;document.body.appendChild(div);return div};var createInvitorButton=function(){var css="margin:-10px 0 0 -5px; position:fixed; left:0; top:0; width:100%; height:46px; z-index:9999999";var html='<img border="0" style="margin:10px 0 0 5px;width:100%" src="http://www.mobilechat.im/image/new_invite.png"/><span class="mcsure" style="position:absolute;top:0;left:0;width:80%;height:80px"></span> <span class="mccancel" style="position:absolute;top:0;right:0;width:20%;height:80px"></span>';var div=document.createElement("div");div.className="mcinvitor";div.innerHTML=html;div.style.cssText=css;document.body.appendChild(div);return div};var showPopWindow=function(data){var popBtn=data["popBtn"];var mcsure=data["mcsure"];var btnObj;if(popBtn["switch"]==="1"||popBtn["switch"]==="true"){if(popBtn["location"]=="center"){btnObj=createInvitorCenterButton();var rs=getElementsByClassName("invitorBtnContent",btnObj);rs[0]["textContent"]=popBtn["content"];var rs=getElementsByClassName("mcsure",btnObj);rs[0]["textContent"]=mcsure||"";setStyles(btnObj);window.onresize=function(){setStyles(btnObj)}}else if(popBtn["location"]=="top"){btnObj=createInvitorButton()}else if(popBtn["location"]=="self"){btnObj=createSelfDefButton();var val=popBtn["selfBtn"];if(typeof val==="string"){try{val=JSON.parse(val)}catch(e){}}var rs=getElementsByClassName("mcselfdefinvitor",btnObj);if(val&&val["path"]){if(val["path"].indexOf("url")===0){rs[0]["style"]["backgroundImage"]=val["path"]}else{rs[0]["style"]["backgroundImage"]="url("+_mc_host+val["path"]+")"}}var rs=getElementsByClassName("mcsure",btnObj);rs[0]["style"]["top"]=val["sureTop"];rs[0]["style"]["left"]=val["sureLeft"];var rs=getElementsByClassName("mccancel",btnObj);rs[0]["style"]["top"]=val["cancelTop"];rs[0]["style"]["left"]=val["cancelLeft"];setStyles(btnObj);window.onresize=function(){setStyles(btnObj)}}var rs=getElementsByClassName("mccancel",btnObj);rs[0].onclick=function(){btnObj["style"]["display"]="none";setTimeout(function(){btnObj["style"]["display"]="inherit"},popBtn["time"]*1e3)};var rs=getElementsByClassName("mcsure",btnObj);rs[0].onclick=function(e){toChat();return e.preventDefault()}}return btnObj};var setStyles=function(btn){var bodyWidth=document.body.clientWidth;if(wrapDiv){wrapDiv.style.width=bodyWidth+"px"}var u=navigator.userAgent;if(u.indexOf("Android")>-1||u.indexOf("Linux")>-1){if(u.indexOf("Android 2.3")>-1){if(u.indexOf("UCBrowser")>-1||u.indexOf("MQQBrowser")>-1){btn["style"]["width"]=bodyWidth+"px"}else{var rs=getElementsByClassName("mcinvitor",btn);rs[0]["style"]["cssText"]+=";-webkit-box-shadow:none; border:1px solid #DCDDDD"}}else{btn["style"]["width"]=bodyWidth+"px"}}else{btn["style"]["width"]=bodyWidth+"px"}};var addViewPort=function(){var viewports=document.getElementsByName("viewport");if(viewports.length>0){var content=viewports[0]["content"];viewports[0]["content"]="user-scalable=0,"+content}else{var metaElement=document.createElement("meta");metaElement["name"]="viewport";metaElement["content"]="user-scalable=0,width=device-width";var head=document.getElementsByTagName("head")[0];head.appendChild(metaElement)}};var visitPoll=function(refuseChat){if(_G["ie8"]||!_G["cookie"]||_G["jump2Chat"]){return false}_G["poll"]=true;var params={unitid:_G["unitid"],cookie:_G["cookie"],cid:_G["cid"]||"",refuseChat:refuseChat?true:false};ajax({url:visit_host+"/visit/poll",method:"POST",params:params,timeout:3e4,timeoutCb:function(){visitPoll()},success:function(res_text,xhr){try{var data=eval("("+res_text+")")}catch(e){setTimeout(function(){visitPoll()},1e3);return}if(data["success"]&&data["usid"]){_G["inviteUs"]=data["usid"];createInviteChatButton(data.inviteContent)}else{setTimeout(function(){visitPoll()},1e3)}},error:function(res_text,xhr){setTimeout(function(){visitPoll()},1e3)}})};function getPath(){return window.location.protocol+"//"+window.location.host+window.location.pathname}var toChat=function(inviteUs){function fireClickEvent(element){if(document.createEventObject){element.click()}else{var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,true);return!element.dispatchEvent(evt)}}_G["jump2Chat"]=true;var link=document.createElement("a");document.body.appendChild(link);var qpart1="";if(inviteUs){qpart1="inviteUs="+_G["inviteUs"]}var qpart2="";if(_G["ipinfo"]&&typeof _G["ipinfo"]=="object"){qpart2="&ipinfosent=true"}var qpart3="&_realref_="+encodeURIComponent(getPath());var qpart4="&cookie="+_G["cookie"];var qpart5="&cid="+_G["cid"];link.href=_mc_host+"/chat/"+_G["unitid"]+"?"+qpart1+qpart2+qpart3+qpart4+qpart5;fireClickEvent(link);return false};function decodeQueryValue(str){var ret="";try{ret=decodeURIComponent(str)}catch(e){}return ret}function getReferrer(){var ret="";var num=0;if(location.search.length>1){var query_str=location.search.replace("?","");var tmp_arr=query_str.split("_realref_");num=tmp_arr.length;var index=query_str.indexOf("_realref_");if(index>=0){ret=query_str.slice(index+10);for(var i=0;i<num-1;i++){ret=decodeQueryValue(ret)}if(ret.length>0)return ret}}var metaRealRef=document.getElementById("_realref_");if(metaRealRef){ret=metaRealRef.getAttribute("realref")||"";if(ret.length>0)return ret}return document.referrer}function checkTagA(){var aTags=document.getElementsByTagName("a");for(var i=0;i<aTags.length;i++){var href=aTags[i].getAttribute("href");if(href&&href.indexOf("mobilechat")>=0){aTags[i].onclick=function(e){toChat();return e.preventDefault()}}}}function saveLocalCookie(data){var cid=data["cid"];var cookie=data["cookie"];if(cid&&!_G["cid"]){setCookie("_mc_cid",cid);if(st){st.setItem("_mc_cid",cid)}}if(cookie&&!_G["cookie"]){setCookie("mccookie",cookie);if(st){st.setItem("mccookie",cookie)}}_G["cid"]=cid||getCookie("_mc_cid");_G["cookie"]=cookie||getCookie("mccookie")}function getUnitid(){var scripts=document.getElementsByTagName("script");for(var i in scripts){var script=scripts[i];var src=script["src"];if(src&&src.indexOf(shotHost+bjspath)>=0){var unitid_arr=src.match(/\?id=(\w+)/);if(unitid_arr[1]){unitid=unitid_arr[1];_G["unitid"]=unitid;return unitid}}}return""}var main=function(){var body=document.body,cookie="",unitid=getUnitid(),dial_page="";if(st){}if(location["href"]){_G["url"]=location["href"]}_G["from_page"]=getReferrer();_G["land_page"]=location["href"];_G["cookie"]=getCookie("mccookie");_G["cid"]=getCookie("_mc_cid");_G["LVTime"]=getCookie("LVTime")||"";setCookie("LVTime",(new Date).getTime());checkTagA();addViewPort();cb2=function(data){saveLocalCookie(data);if(data["success"]){if(_G["ipinfo"]){visitPoll()}createMobileChatButton(data);var delay=parseInt(data["popBtn"]["delay"])||4;setTimeout(function(){showPopWindow(data)},delay*1e3)}};cb1=function(data){saveLocalCookie(data);_G["ipinfo"]=remote_ip_info;if(!_G["poll"]){visitPoll()}};if(unitid){var rstr=getCookie("ipinfo");if(st){if(!_G["cookie"]){_G["cookie"]=st.getItem("mccookie")}if(!_G["cid"]){_G["cid"]=st.getItem("_mc_cid")}if(!rstr){rstr=st.getItem("ipinfo")}}try{remote_ip_info=JSON.parse(rstr)}catch(e){}if(remote_ip_info&&typeof remote_ip_info=="object"){_G["n"]=remote_ip_info["country"];_G["p"]=remote_ip_info["province"];_G["d"]=remote_ip_info["district"];_G["i"]=remote_ip_info["isp"];_G["c"]=remote_ip_info["city"]}else{remote_ip_info=null}_G["ipinfo"]=remote_ip_info;if(!remote_ip_info){getScript(iplookup_url);var timer0=setInterval(function(){if(remote_ip_info&&typeof remote_ip_info=="object"){clearInterval(timer0);var rstr=JSON.stringify(remote_ip_info);if(st){st.setItem("ipinfo",rstr)}setCookie("ipinfo",rstr);if(remote_ip_info){_G["n"]=remote_ip_info["country"];_G["p"]=remote_ip_info["province"];_G["d"]=remote_ip_info["district"];_G["i"]=remote_ip_info["isp"];_G["c"]=remote_ip_info["city"]}var ipinfoParams={cookie:_G["cookie"]||"",fp:_G["from_page"],id:_G["unitid"],lvt:_G["LVTime"],lp:_G["url"],n:_G["n"],p:_G["p"],i:_G["i"],d:_G["d"],c:_G["c"]};jsonp(stat_host+"/unit/ipinfo",ipinfoParams,"cb1")}},1e3)}var unitBtnparams={cookie:_G["cookie"]||"",lp:_G["url"],id:_G["unitid"],fp:_G["from_page"]||"",lvt:_G["LVTime"]||""};if(_G["n"]){unitBtnparams={cookie:_G["cookie"]||"",lp:_G["url"],id:_G["unitid"],fp:_G["from_page"]||"",lvt:_G["LVTime"]||"",n:_G["n"],p:_G["p"],d:_G["d"],i:_G["i"],c:_G["c"],localr:document.referrer}}jsonp(stat_host+"/unit/button",unitBtnparams,"cb2")}};var readyRE=/complete|loaded|interactive/;var ready=function(callback){var fireDOMReadyEvent=function(){window.clearInterval(timer);callback()};if(!!window.ActiveXObject){var timer=null;timer=setInterval(function(){try{document.body.doScroll("left");fireDOMReadyEvent()}catch(ex){}},50)}else{if(readyRE.test(document.readyState))callback();else document.addEventListener("DOMContentLoaded",function(){callback()},false)}};ready(main);